<ng-template #content let-modal data-keyboard="false" data-backdrop="false">
    <div class="modal-header">
      <h4 class="modal-title" id="modal-basic-title">Report Criteria</h4>
      <button type="button" class="close text-danger" aria-label="Close" data-dismiss="modal" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
        <div *ngIf="showAlert" class="alert alert-danger alert-dismissible fade show" role="alert">
            <strong>Error! </strong> {{alertMsg}}
            <button type="button" class="close" data-dismiss="alert" aria-label="Close" (click)="closeAlert()">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
  
      <form [formGroup]="reportcriteria">
      
        <div>
          <label for="fromDate">As on Date</label>
          <div class="input-group">
            <input type="text" placeholder="dd/mm/yyyy" class="form-control" [ngModel]="fromdate" disabled bsDatepicker
            formControlName="fromDate" [bsConfig]="{ dateInputFormat: 'DD/MM/YYYY', containerClass:'theme-dark-blue' }"
            [isOpen]="isOpenFromDp">
          <div class="input-group-append">
            <button mat-raised-button class="btn btn-outline-secondary" type="button" (click)="isOpenFromDp = !isOpenFromDp">
              <i class="fa fa-calendar" aria-hidden="true"></i>
            </button>
          </div>
          </div>
        </div>
        <!-- <div >
          <small for="acc_type_cd">Loan Type</small>
           <select id="acc_type_cd" class="form-control form-control-sm" formControlName="acc_type_cd">
             <option *ngIf="AcctTypes" disabled>Choose</option>
             <option  (change)="takeLoanVal(acctType)" *ngFor="let acctType of AcctTypes" [value]="acctType.acc_type_cd">
               {{acctType.acc_type_cd +' ' + acctType.acc_type_desc}}
             </option>
           </select>
        </div> -->
      </form>
    </div>
    <div class="modal-footer">
        <button mat-raised-button class="btn btn-primary" (click)="SubmitReport()">Submit</button> &nbsp;
        <button mat-raised-button class="btn btn-light" (click)="modalRef.hide()">Close</button>
    </div>
  </ng-template>
  
  <div class="row d-flex justify-content-center align-items-center pt-4"
  style="background-color: #78c2ad21; min-height: 20vh;">
  
  <!-- {{ReportUrl}} -->
  <!-- <ng-template #printDiv> -->
    <div  class="col-xs-12 col-sm-12 col-md-8 col-lg-8 shadow-sm mb-4 bg-white p-3">
      <div>
       <button mat-raised-button type="button" class="btn btn-rounded btn-primary m-1" (click)="closeScreen()" >Close</button>
       <button mat-raised-button type="button" 
        class="btn btn-rounded btn-primary m-1" 
        [useExistingCss]="true"
        printSectionId="mattable" 
        [printStyle]="{ '@page': { size: 'landscape !important' } }"
        ngxPrint>Print</button>
       <button mat-raised-button type="button" class="btn btn-rounded btn-primary m-1" (click)="downloadexcel()">Export as EXCEL</button>

        <button mat-raised-button type="button" class="btn btn-rounded btn-primary m-1" (click)="onLoadScreen(content)">Retrieve</button>
      
      </div>
      </div>
  <!-- </ng-template> -->
  <!-- <ng-container *ngTemplateOutlet="printDiv"></ng-container> -->
  
  <div class="col-xs-12 col-sm-12 shadow-lg mb-4 bg-white p-3 mkScroll">
    
   
   
           
<!-- npa-report.component.html -->
      <div class="filters-card">
  <div class="filter-row">
    <div class="filter-group">
      <label>Branch</label>
      <select [(ngModel)]="selectedBranch" (change)="applyFilters()">
        <option value="">All</option>
        <option *ngFor="let b of branchData" [value]="b.brn_cd">{{ b.brn_name }}</option>
      </select>
    </div>

    <div class="filter-group">
      <label>Loan Type</label>
      <select [(ngModel)]="selectedLoan" (change)="applyFilters()">
        <option value="">All</option>
        <option *ngFor="let l of loanTypeData" [value]="l.acc_type_cd">{{ l.acc_type_desc }}</option>
      </select>
    </div>
  </div>

  <div class="filter-row checkbox-group">
    <label><input type="checkbox" [(ngModel)]="filters.standard" (change)="applyFilters()"> Standard > 0</label>
    <label><input type="checkbox" [(ngModel)]="filters.sma0" (change)="applyFilters()"> SMA 0 > 0</label>
    <label><input type="checkbox" [(ngModel)]="filters.sma1" (change)="applyFilters()"> SMA 1 > 0</label>
    <label><input type="checkbox" [(ngModel)]="filters.sma2" (change)="applyFilters()"> SMA 2 > 0</label>
    <label><input type="checkbox" [(ngModel)]="filters.sub_standard" (change)="applyFilters()"> Sub Standard > 0</label>
    <label><input type="checkbox" [(ngModel)]="filters.doubtful1" (change)="applyFilters()"> Doubtful 1 > 0</label>
    <label><input type="checkbox" [(ngModel)]="filters.doubtful2" (change)="applyFilters()"> Doubtful 2 > 0</label>
    <label><input type="checkbox" [(ngModel)]="filters.doubtful3" (change)="applyFilters()"> Doubtful 3 > 0</label>
  </div>

  <div class="filter-actions">
    <button class="reset-btn" (click)="resetFilters()">Reset</button>
  </div>
</div>
      <div id="mattable">
      <div class="justify-content-center" style="text-align:center">
          <br><h4>{{ardbName}} ({{branchName}})</h4>
                  
                  <h4>Run Date & Time : {{today}} </h4>
                  <h4> <u> NPA List All as on  {{reportcriteria.controls.fromDate.value?.toDateString() | date: 'dd/MM/yyyy'}}</u></h4>
      </div>
      <table class="report-table">
        <thead>
          <tr>
            <th *ngFor="let header of headers" [style.width]="header.width"><b>{{ header.label }}</b></th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let branch of groupedData">
            <!-- Branch Header -->
            <tr class="branch-header">
              <td colspan="33">
                <b>{{ getBranchName(branch.brn_cd) }} ({{ branch.brn_cd }})</b>
              </td>
            </tr>

            <ng-container *ngFor="let group of branch.groups">
              <!-- Loan Type Header -->
              <tr class="loan-header">
                <td colspan="33">
                  <b>Loan Type: {{ getLoanTypeName(group.acc_cd) }} ({{ group.acc_cd }})</b>
                </td>
              </tr>

              <!-- Loan Type Data -->
              <tr *ngFor="let item of group.data">
                <td *ngFor="let header of headers" [style.width]="header.width" [ngClass]="{ 'text-right': header.isAmount }">
                  <ng-container *ngIf="header.isDate">
                    {{ item[header.key]?.substr(0, 10) }}
                  </ng-container>
                  <ng-container *ngIf="header.isAmount && !header.isDate">
                    {{ item[header.key] | number:'1.2-2' }}
                  </ng-container>
                  <ng-container *ngIf="!header.isAmount && !header.isDate">
                    {{ item[header.key] }}
                  </ng-container>
                </td>
              </tr>

              <!-- Loan Type Total -->
              <tr class="total-row type-total">
                <td colspan="4"><strong>Total</strong></td>
                <td class="text-right"><strong>{{ group.total.disb_amt | number:'1.2-2' }}</strong></td>
                <td colspan="5"></td>
                <td class="text-right"><strong>{{ group.total.outstanding_prn | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.curr_prn | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.ovd_prn | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.ovd_intt | number:'1.2-2' }}</strong></td>
                <td colspan="20"></td>
              </tr>
            </ng-container>

            <!-- Branch Total -->
            <tr class="total-row branch-total">
              <td colspan="4"><strong>Branch Total</strong></td>
              <td class="text-right"><strong>{{ branch.total.disb_amt | number:'1.2-2' }}</strong></td>
              <td colspan="5"></td>
              <td class="text-right"><strong>{{ branch.total.outstanding_prn | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.curr_prn | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.ovd_prn | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.ovd_intt | number:'1.2-2' }}</strong></td>
              <td colspan="20"></td>
            </tr>
          </ng-container>

          <!-- Grand Total -->
          <tr class="total-row grand-total">
            <td colspan="4"><strong>Grand Total</strong></td>
            <td class="text-right"><strong>{{ grandTotal.disb_amt | number:'1.2-2' }}</strong></td>
            <td colspan="5"></td>
            <td class="text-right"><strong>{{ grandTotal.outstanding_prn | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.curr_prn | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.ovd_prn | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.ovd_intt | number:'1.2-2' }}</strong></td>
            <td colspan="20"></td>
          </tr>
        </tbody>
      </table>
      </div>
      </div>
      <!-- <div *ngFor="let branch of groupedData" class="branch-section">
        <h3><b>{{ getBranchName(branch.brn_cd) }} ({{ branch.brn_cd }})</b></h3>

        <div *ngFor="let group of branch.groups">
         <h4><b>Loan Type: {{ getLoanTypeName(group.acc_cd) }} ({{ group.acc_cd }})</b></h4>

          <table class="report-table">
            <thead>
              <tr>
                <th *ngFor="let header of headers"><b>{{ header.label }}</b></th>
              </tr>
            </thead>
            <tbody>
            <tr *ngFor="let item of group.data">
              <td *ngFor="let header of headers" [ngClass]="{ 'text-right': header.isAmount }">
                <ng-container *ngIf="header.isDate">
                  {{ item[header.key]?.substr(0, 10) }}
                </ng-container>
                <ng-container *ngIf="header.isAmount && !header.isDate">
                  {{ item[header.key] | number: '1.2-2' }}
                </ng-container>
                <ng-container *ngIf="!header.isAmount && !header.isDate">
                  {{ item[header.key] }}
                </ng-container>
              </td>
            </tr>
              <tr class="total-row type-total">
                <td colspan="4"><strong>Total</strong></td>
                <td class="text-right"><strong>{{ group.total.disb_amt | number:'1.2-2' }}</strong></td>
                <td colspan="5"></td>
                <td class="text-right"><strong>{{ group.total.outstanding_prn | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.curr_prn | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.ovd_prn | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.ovd_intt | number:'1.2-2' }}</strong></td>
                <td colspan="7"></td>
                <td class="text-right"><strong>{{ group.total.standard | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.sma0 | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.sma1 | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.sma2 | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.sub_standard | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.doubtful1 | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.doubtful2 | number:'1.2-2' }}</strong></td>
                <td class="text-right"><strong>{{ group.total.doubtful3 | number:'1.2-2' }}</strong></td>
                <td colspan="4"></td>
               </tr>
               <tr class="total-row branch-total">
              <td colspan="4"><strong>Branch Total</strong></td>
              <td class="text-right"><strong>{{ branch.total.disb_amt | number:'1.2-2' }}</strong></td>
              <td colspan="5"></td>
              <td class="text-right"><strong>{{ branch.total.outstanding_prn | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.curr_prn | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.ovd_prn | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.ovd_intt | number:'1.2-2' }}</strong></td>
              <td colspan="7"></td>
              <td class="text-right"><strong>{{ branch.total.standard | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.sma0 | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.sma1 | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.sma2 | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.sub_standard | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.doubtful1 | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.doubtful2 | number:'1.2-2' }}</strong></td>
              <td class="text-right"><strong>{{ branch.total.doubtful3 | number:'1.2-2' }}</strong></td>
              <td colspan="4"></td>
            </tr>
              <tr class="total-row grand-total">
            <td colspan="4"><strong>Grand Total</strong></td>
            <td class="text-right"><strong>{{ grandTotal.disb_amt | number:'1.2-2' }}</strong></td>
            <td colspan="5"></td>
            <td class="text-right"><strong>{{ grandTotal.outstanding_prn | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.curr_prn | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.ovd_prn | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.ovd_intt | number:'1.2-2' }}</strong></td>
            <td colspan="7"></td>
            <td class="text-right"><strong>{{ grandTotal.standard | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.sma0 | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.sma1 | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.sma2 | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.sub_standard | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.doubtful1 | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.doubtful2 | number:'1.2-2' }}</strong></td>
            <td class="text-right"><strong>{{ grandTotal.doubtful3 | number:'1.2-2' }}</strong></td>
            <td colspan="4"></td>
            </tr>
            </tbody>
          </table>
        </div>

    
 
   
  </div> -->
  
  <!-- <ng-container *ngTempleteOutlet="printDiv"></ng-container> -->
  <div  class="col-xs-12 col-sm-12 col-md-8 col-lg-8 shadow-sm mb-4 bg-white p-3">
    <div>
     <button mat-raised-button type="button" class="btn btn-rounded btn-primary m-1" (click)="closeScreen()" >Close</button>
     <button mat-raised-button type="button" 
     class="btn btn-rounded btn-primary m-1" 
     [useExistingCss]="true"
     printSectionId="mattable" 
     [printStyle]="{ '@page': { size: 'landscape !important' } }"
     ngxPrint>Print</button>
     <button mat-raised-button type="button" class="btn btn-rounded btn-primary m-1" (click)="downloadexcel()">Export as EXCEL</button>

 <button mat-raised-button type="button" class="btn btn-rounded btn-primary m-1" (click)="onLoadScreen(content)">Retrieve</button>

    
    </div>
    </div>
 
  </div>
  <loading *ngIf="isLoading"></loading>
  
